---
title: 技术方案 Webinar - 系统间集成
date: 2023-07-15 20:54:03
sidebar: true
head:
- - meta
- name: keyword
  content:  系统间集成
  description:  应用系统中常见的集成问题。
---

## 系统集成面临哪些问题和挑战？

- 团队合作，开发排期和联调，跨系统联调和上线
- 系统升级和切换，对集成系统的安全性问题
- 有些企业没有统一的集成平台，在集成的协议和格式上不统一
- 最终一致性问题
- 主数据同步问题
- 安全和统一认证打通
- 性能和可靠性处理、降级
- 可观测性
- 跨系统职责设计
- 多语言和国际化在系统集成时的挑战

## 对于系统集成有哪些实践？

- 统一的集成平台非常重要，B 端大型企业务必要开发自己的集成平台，例如 内部 API 市场
  - 统一的系统发布和注册机制和流程
  - 统一的鉴权方式（M2M，不是 H2M），HAMC（AK/SK）、国密等加密方式
  - 服务承诺：可用性、系统可靠性级别、性能指标
  - 测试数据池
  - 文档中心
  - 统计的消息和传输协议格式
  - API 组合、编排（有些地方叫做智能中台）
  - 目前好像没有看到开源的集成平台，商业的有 Mule Software、华为的罗马（Roma，华为办公云中的一部分）提供过
- 团队合作，开发排期和联调
  - 怎么谈接口？怎么排期？怎么同步上线？
  - 以项目制驱动，通过项目经理（PMO）协调所有的团队资源和计划，根据需求打分机制排优先级。
    - 瀑布：提前统一规划
    - 敏捷：需求驱动，提前一个迭代或者在项目规划阶段提需求
    - 精益或者看板：处理流量需求
  - 每隔一段时间（例如，每个月）所有团队统一参与一个集成计划会议
  - 能独立上线还是走版本火车？
    - 更多偏向于版本火车，原因是提前上去没有端到端验证，有些专家可能会说通过 API 测试的方式处理，实际上比较难
  - 对于团队级 PM/TL 的启示是一定要找到 PMO 这个干系人
- 跨系统职责设计，会为了某些职责归哪些系统做吵架，对于 TL/PM 怎么应对？
  - 相关方都会以难以维护和工作量为理由讨论
  - 上升，由上级的架构师决定
- 系统升级和切换，对集成系统的安全性问题
  - 验证API 改变对其他系统影响：
    - 监控：有没有 API 调用异常的收集
    - 测试：契约测试（Pact、Spring Contract），契约测试的本质是一种简单的 API 测试，关注字段是否匹配、类型是否相同，不做逻辑验证
  - 切换和兼容：
    - 兼容，API 地址不变，字段信息变更的使用
    - 升级版本，在 API 前缀上增加一个版本号，字段信息变更比较多的时候，对外的 API 设计时候强制增加版本号
    - 提供新的接口
    - 其他手段
      - 给相关依赖方通知，手工验证
- 最终一致性问题，重试补偿，这里特指系统之间的处理
  - 系统之间推荐优先使用 API 和补偿，一般情况避免使用 MQ 通信
    - 需要补偿的 API 需要支持幂等
    - Spring 的 Retry，Retry 多次后可以执行本地清理、发通知的方式处理，服务重启后，Retry 就会丢失。【其实可以做一个基于 Retry 注解，结合本地数据库记录的框架，在重启后重新执行 Retry 任务。】
    - 使用定时任务记录补偿机制，基于多个实例的【重要场合，推荐使用】
    - 使用自己消费 MQ 的方式实现，利用 MQ 事务消息的机制来做
- 主数据同步问题，不同系统之间的维度表或者基础数据如何给其他系统使用
  - 人肉拷贝，通过映射表方式处理
  - 数据仓库，不是数据湖，通过数据中心化的仓库和 ETL 作业实现，数据的清洗，创建维度数据，进入数据集市被下游使用，一般都是 T+1 的场景
  - 主数据系统（MDM），参考华为的《华为数据之道》这本书有关于主数据的描述
  - 准实时数据同步（适合非主数据、业务数据）
    - CDC：Binlog、Flink、Kafka，对业务透明的数据分发
    - CDS（Change Discovery Service）：在应用层基于业务知识的数据分发，适合需要解决业务冲突的情况
- 跨系统联调和上线，软件工程中的政治，有什么沟通技巧吗？
  - 目的：使用什么让需要联调方配合？
  - 如果是 API 提供方：提前定义 API 契约，如果在设计阶段，最好使用一套公司内的标准 API 文档表格（接口清单和接口卡）。在开发阶段，文档提供可以是： Swagger 的 OpenAPI、SAML。
  - 如果是 API 消费方：先找架构师技术层面沟通，沟通无效时，上升到 PMO，从责任层面沟通（本质还是权责沟通问题，如果私聊解决不了公开沟通）。
- 安全和统一认证打通
  - 架构部门提供 IAM Server 和登录相关机制
  - 应用服务提供 IAM Resource Server、Auth Client（BFF 来做）
  - 一般来说根据是否是一个产品来划分 Auth Client，不同的产品有不同的鉴权场景。
  - 统一登录和单点登录：
    - 跳转到 IAM 登录或者授权一次
    - 登录一次，整个系统无感
- 性能和可靠性处理、降级
  - 降级使用微服务的降级机制即可
  - 需要结合一致性补偿工具在对方恢复后，直接补偿即可
- 可观测性
  - 业务的观测在系统内部即可，一般通过 APM 实现
- 跨系统职责设计
  - 我们为什么会吵架？本质是时间条件约束后，工作量如果又要膨胀，损害利益，这样就会推活儿。如果机制是工作量越多，体现的 KPI 越大，会反过来抢活儿。技巧：如果一个活儿不想干，就吹其价值，然后让别人强。架构部门和产品部门的目标往往不一致，甚至矛盾；**不痛（或者现在不痛）就不推，有痛点不需要推**；因为短视无法看到长期痛点，可以预警，但是不用着急现在推。
  - 怎么避免吵架呢？基于文化：企业文化是制度、秩序的集合体现。
- 多语言和国际化在系统集成时的挑战
  - http://shaogefenhao.com/libs/webinar-notes/java-solution-webinar-14.html
  - 在各自的应用处理国际化问题，系统集成不处理系统语言问题。关于用户语言，用户产生的内容中的多语言，增加业务字段即。
    - 对于系统标签和文案、报错信息：使用 i18N 翻译
    - 对于主数据来说
      - 本位语言：系统开发者采用的语言基线，所有的翻译文本基于此
      - 工作语言：系统支持的几种工作语言，常见有：英语、中文、西班牙文、日文

## 有没有相关专业讲这块的材料和书籍？



## 参考资料

- https://appinventiv.com/blog/open-source-api-management-tools/

## 录屏

链接: https://pan.baidu.com/s/10pF9noW8YflI0JFWkcz_Rg?pwd=6qwq 提取码: 6qwq 复制这段内容后打开百度网盘手机App，操作更方便哦

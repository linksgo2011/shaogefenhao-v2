---
title: 技术方案 Webinar - 如何快速定位问题
date: 2024-03-02 20:54:03
sidebar: true
head:
- - meta
- name: keyword
  content:  如何快速定位问题
  description:  如何快速定位问题
---

## 如何生产是出现了 Bug，如何快速定位，并修复？

- 确认是否是特性合适 Bug。
  - 大规模项目，如何沉淀当前所有的特性（由 BA、QA 来判定是否是问题）
- 分类（紧急、非紧急）、分模块，找到归属团队（假如团队很大）
- 看日志
  - 生产日志级别定义为 INFO，非生产开启 DEBUG 级别
  - 看错误码，有些系统会自定义一套错误码，快速查询问题，有些错误码会有一个编号规则编号，例如：系统缩写-服务缩写-错误码，类似于 "EO0001"
- 链路追踪
  - 从日志中，找到链路追踪，定位问题
- 无法根据日志分析问题怎么办？
  - 测试环境复现
  - 生产环境复现
  - 补充日志，再次上线
  - 把参数信息记到表里面，例如外部系统调用，这样查问题简化很多
  - 降低日志级别（例如晚上没人用的时候，把日志改成 DEBUG 模式）
  - Arthas 侵入应用调试出参入参
  - 做一个开关，开启后，自动把方法参数序列化后输出（极大降低性能）
  - 有 IDEA Remote 工具可以实现远程调试吗？ Jrebl
- dump 当前实例的内存（Jmap）重现常见，进行观测
- 通过 APM/Trace 进行观测
  - elastic-apm
  - OpenTelemetry
- 线上数据动态脱敏（类似产品，类似 ETL 工具，成本比较高）

## 有哪些常见的解决问题套路？如果一个奇怪的 Bug 一直没有头绪，怎么弄？

越是难调试的 Bug，最后的原因往往都比较愚蠢。

- 清缓存：Redis 缓存，上线时，有同事给某个对象加了一些字段，导致缓存能反序列化回来，但是非常诡异的出现数据不完整，而且数据库却有数据的情况（脚本修复了数据）。
- 单例数据：YAML 对象，被某个同事在某个接口中修改了，导致某些业务场景后，才会触发这个 Bug，且重新上线后往往消失。
- 网络中过滤机制：一段 HTML 后半段会被诡异的截断，后来发现是 HTML 中有一些敏感字符串，只要出现了该字符串，就会被截断，非常难以查询。
- 刷新
- 重启
- 维护一个表，记录常见的问题清单
- 非生产或者本地写代码的时候，养成习惯，不要单步调试，尽量以日志为主，让日志能描述业务过程
- 尽量不要在本地依赖启动服务来调试，通过测试（单元测试、API测试）实现业务，更容易发现服务
- 一些低级问题，使用**小黄鸭调试法**。
  - 例如调用地址、端口写错了，这种愚蠢的问题，
  - 一些容易错误的字符串：lI，注意区分，使用单词拼写提示打开
  - 隐藏字符串，比如换行符、空格、缩进等，在判断相等和正则时容易出错
  - 平台差异
    - 大小写敏感（Linux 和 Windows）,DBUnit 库对表名在 Windows 不报错，Linux 报错
    - Windows 和 Linux 换行方式的差异

## 解决一个困难 Bug 的思路是什么？

- 根据逻辑 + 数据的思路，定位代码位置，给予一些基础数据作为入参，进行重现调试。
- 根据变更记录，查询代码提交记录。
- 观察现有的线索、现象，收集更多样本，无法重现的这类情况，例如 HTML 截断的问题，只有部分用户出现，而且极少量，通过用户的输入信息。
- 求助团队，团队 Code Review。
- 尝试观测参数、某些对象的信息？
- 反模式：
  - 过多一些假设，导致一些可能得情况，被错过。
- 先枚举所有的可能情况（不做假设），然后逐一排除，避免在同一个方向打转。

## 录屏

链接: https://pan.baidu.com/s/1R15tAkdz9mOLvUmLGPSyRA?pwd=5537 提取码: 5537 复制这段内容后打开百度网盘手机App，操作更方便哦

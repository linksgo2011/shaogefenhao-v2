---
title: 系统设计 | 如何了解一个不熟悉的系统？
date: 2024-07-13 17:42:32
sidebar: auto
category: 
  - 软件架构
head:
  - - meta
    - name: keyword
      content: 如何了解一个不熟悉的系统？
      description: 如何了解一个不熟悉的系统？
---

假设是接收的一个完全不熟悉的项目，需要进行重写改造，第一步工作就是全面的了解一个系统。甚至建议规划一段时间，可能是 2 周到 3 周，做一个专业的技术现状调研，把现有系统上上下下梳理一遍，通过采访、实地走查全面的理解现有系统。例如，关键的人员、业务场景、项目架构、基础设施、数据库、代码等内容。

这里我把我们做过的一个技术现状调研的过程整理下来了。

## 01 了解关键人员

这点非常重要，如果很多关键人员已经无法联系对新项目的推进会有非常大的打击。

- 业务人员。
- 原有的需求分析人员。
- 可以联系到的用户。
- 现在代码的维护者。
- 运维人员。

获得人员信息后，需要制作干系人矩阵，分析这些人员整个项目中的影响力。另外创建一个对接人清单，记录相关人员的联系方式。

## 02 串讲关键的业务场景

关键业务场景最自然的方式是让熟悉的人照着系统界面进行操作或者讲解。这种方式很普遍但往往不够深刻，更加深刻的方法是通过“业务凭证追溯”。举个例子你想了解保险系统投保的过程，最深刻的方式是去线下找到做保险的业务员，带着他的视角把整个过程中产生的单据、表单收集下来，推演整个过程中涉及的商业凭证。 完成这一步后，梳理这个项目中使用的术语清单。梳理术语表也是理解一个项目最快的办法，因为语言的边界就是认知的边界。

为什么商业凭证对关键业务场景的认识如此重要？

软件其实是一种知识的介质，遗留系统虽然技术老化，但是是充分沉淀了业务流程，这些业务往往也是经过长时间沉淀的。业务凭证是商业过程构建的契约，经过演化，这些契约一般是不多不少的，过少就会扯皮，过多用起来就麻烦。

业务凭证是非常可信的一手资料，不过现在无纸化办公的发展，收集纸质单据可能不那么容易。

## 03 系统架构 

了解完业务场景后，就可以梳理项目架构了。梳理项目架构的时候，最重要的是找到清晰的系统边界。这里推荐使用使用C4模型表现项目架构和依赖关系。

C4模型是一种层层递进展开的方式来描述项目结构（系统-容器-组件-类），避免把在绘制图形的时候把不同层级的实体放到一起，造成架构图看起来非常混乱。为了表达项目依赖关系，我们可以系统一级（即以每个系统为单位）；表达自身项目架构，用容器这一级。

做到系统和容器这一两级即可。

在了解系统架构时，需要把技术栈和第三方包依赖、依赖服务的调用关系和认证服务这几项摸清楚。尤其是认证服务，根据一个场景把认证过程理清楚，差不多整个系统调用过程就很熟悉了。

## 04 了解 DevOps

项目中的 DeveOp s工作很琐碎，但是如果了解这些信息，对上线、调试都有很多帮助。

- 检查是否有 Dev、QA、UAT、Prod 等多环境
- CI/CD 平台
- 代码仓库
- 制品管理(artifacts)
- 密匙管理
- 部署脚本
- 安全扫描工具，例如 Findbugs、Sonarqube
- 定时任务
- 备份
- 日志

根据具体的是把上线过程梳理一遍，这样就能知道有哪些制品且如何被部署到线上环境的，可以绘制一个网络拓扑图来描述应用的部署情况。

## 05 重建数据库核心模型或者领域模型

深刻了解一个系统的方法是重建数据库核心模型和领域模型。这里面有两个关键词：重建和核心。如果只是把现有的 E-R 图找出来起不了太多作用，需要自己绘制整理一遍，才能真正理解每个模型的含义；另外，长期演化的系统模型可能多大数百个，无法把每张表或者每个数据模型一一整理，那么抓住核心就是非常关键的一步。

其实一个模型就是一个业务概念，以一款售后的 CRM 系统为例，其核心模型可能非常简单。售后 CRM 的生意是当用户需要售后服务时，销售方需要创建一个服务工单来管理相关的售后问题。一个极端简陋的 CRM 就是一个服务工单，服务工单的两端构成了消费者和售后服务方之间的契约。例如，消费者买了一部手机，在保修期类需要维修，消费者发起了保修的请求，售后服务方通过服务工单作为契约接过了手机，开始维修。

售后服务方的接待员需要在系统中有一个身份，那么就需要引入一个用户的概念。紧接着，如果维修工作需要材料，CRM 就需要增加对材料的管理功能，否则就只能用纸、Excel 来管理消耗的物料。对于大型企业来说，这些物料需要在网点、总部之间流转，那么就需要建立一套调拨关系。网点和总部之间的物料来往需要出入库相关的流程来支持多地的库存管理。为了 进一步扩大服务体系，会将一些地区的网点承包给当地商户，这样物料的往返、工费就发生了结算，以及财务相关的逻辑就必不可少了。

把数百个表简化到一页纸就能画出来的核心模型图，最后续的工作非常有价值。

## 06 了解上下游系统和 API

这里是个大坑，因为很多系统由于维护者的不上心，可能根本不知道有哪些系统在调用它。如果还有熟悉系统的老维护者在问题不在，如果已经无法联系维护者了，只能想一些办法来梳理上下游系统和 API。

第一个办法是日志。

另外是个办法是把测试环境的 API 加上服务之间鉴权。

更大的坑是数据库被人直接连接读取数据，甚至写入数据（这个就更魔幻了）。



## 07 通过修几天 Bug 了解代码

如果只是看静态的代码，就算把代码背下来也没啥用，这话虽然有点不那么严谨。但是对于大多数人来说，了解跑起来的代码才能对齐有真实的认识。通过修 Bug 来熟悉一个系统这个逻辑也适用于培训招聘来的新成员，或者参与一些开源项目。

通过修 Bug 需要深入某个场景，并通过这个场景进行单步调试、测试数据、寻找日志。另外修复 Bug 也算是对代码了解程度的一种考试，能快速修复 Bug 也说明能够根据系统添加新的特性了。有条件的情况下，也可以寻找有经验的同事结对编程。